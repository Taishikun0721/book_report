# DNSをはじめよう

これを読んで、初めてドメインをとった。
ドメインは、取得するサイトによって同じでも値段が全然違う。これは、`レジストリ`, `レジストラ`, `リセラ`などの
住み分けがあって、仲介業者が入ってるから、マージンとかを乗っけたら高くなるよねって言う話らしい。

ドメインは`レジストリ`から発行されて、これを卸売の`レジストラ`や`リセラ`が購入する構造になっている。


また,レジストリを決めているのは、`ICANN`と言う団体らしい、これは、well knownポートの番号とかを決めている団体と同じらしい。22番SSH, HTTP80番とか


## ドメインを取得してみた。

実際に、お名前ドットコムでドメインを取得してみた。
めっちゃ簡単だったけど、やたらとサーバーの契約を進めてくるのでめんどくさいなと思った。

けど、普通に考えてドメイン取る人はサーバー必要だから自然な営業か。

デフォルトでは自動更新の仕組みなども付いていて、そう簡単にリンク切れにはならない様な仕組みになっているんだなと思った。

今回は、`.work`で取得したら1円だった。安かった。

## AWSのroute53にネームサーバーを変更
お名前ドットコムで取得した、ドメインのデフォルトのネームサーバーは、決まっている。
それを、route53でネームサーバーを立て直して、登録し直した。
けど、わざわざネームサーバーを自分で建て直す理由は何かまでわからなかった。
やっぱりAWSのサービスを使ってたら、他のAWSのサービスとかと連携しやすいとかあるんかな？調べてみよう。

## リゾルバ

リクエストの、ドメイン情報を受け取って、ネームサーバーに問い合わせてくれる。

これを、実際のコマンドでやると

```
dig +norecurse +noall +author ~~~~~~ ns @a.root-servers.net
```

とすると、ルートサーバーに問い合わせてくれて、下記が返ってくる。
```
jp.			172800	IN	NS	a.dns.jp.
jp.			172800	IN	NS	d.dns.jp.
jp.			172800	IN	NS	e.dns.jp.
jp.			172800	IN	NS	f.dns.jp.
jp.			172800	IN	NS	h.dns.jp.
jp.			172800	IN	NS	g.dns.jp.
jp.			172800	IN	NS	c.dns.jp.
jp.			172800	IN	NS	b.dns.jp.
```

この中のどれかですよってことなので、この中のアドレスを選んで同じ作業を繰り返す。

```
dig +norecurse +noall +author ~~~~~~ ns @a.dns.jp
```
みたいな感じで繰り返して、アンサーセクションが答えになる。
`+author`で返ってこなくなって、`+answer`にしたら返ってきた。詳しくはわからん。

ポイントは1回でアンサーセクションが返ってこないところで、DNSは階層になって制御されてるので、まず一番上のルートサーバーに問い合わせて、次はこのドメイン、その次はこのドメインという風にドメイン毎に担当するサーバーが決まっている。

なので複数回問い合わせを行う必要があって
今回は、手作業でやったけど、実際は自動でされる。`+ norecurse`が再帰的に処理しないという意味のオプション。

## 疑問点

- お名前ドットコムに、ネームサーバーを登録するときに複数登録するのが必須だった。これは、リクエストを分散するための冗長化(DNSラウンドロビン)とかの考え方なのかなーと思いつつ。しっかりと調べられていない。チャンスがあれば勉強したい。

時間あるときに、digコマンドとかで遊んでみようと思う。

